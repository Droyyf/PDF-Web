<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Composer Web</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">ðŸ“„</div>
                    <h1 class="app-title" id="appTitle" style="cursor: pointer;">PDF COMPOSER</h1>
                </div>
                <div class="header-controls">
                    <!-- Removed header upload button - using only center button -->
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Main Menu -->
            <div id="emptyState" class="empty-state">
                <div style="position: relative; width: 100%; height: 0; padding-top: 56.2500%; 
                  padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden; 
                  border-radius: 8px; will-change: transform;"> 
                   <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;" 
                     src="https://www.canva.com/design/DAGvKyYErIQ/UZnUXQIVwWwGbeQFnInMcg/view?embed" allowfullscreen="allowfullscreen" allow="fullscreen"> 
                   </iframe> 
                 </div> 
                 <a href="https://www.canva.com/design/DAGvKyYErIQ/UZnUXQIVwWwGbeQFnInMcg/view?utm_content=DAGvKyYErIQ&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton" target="_blank" rel="noopener">Beige and Black Minimalist Project Deck Presentation</a>
                <div class="empty-content">
                    <button class="flat-upload-btn" id="chooseFileBtn">
                        <span class="btn-icon">ðŸ“„</span>
                        <span class="btn-text">PDF PROJECT</span>
                    </button>
                </div>
            </div>

            <!-- PDF Viewer -->
            <div id="pdfViewer" class="pdf-viewer hidden">
                <!-- Enhanced Thumbnail Panel -->
                <aside class="thumbnail-panel">
                    <div class="panel-header">
                        <div class="panel-title-section">
                            <h3 class="panel-title">PAGES</h3>
                            <div class="page-counter">
                                <span id="pageCount" class="page-count">0</span>
                                <span class="page-label">TOTAL</span>
                            </div>
                        </div>
                        <div class="selection-summary">
                            <div class="selection-item">
                                <span class="selection-icon">â—‹</span>
                                <span id="citationCount" class="selection-count">0</span>
                                <span class="selection-label">CITATIONS</span>
                            </div>
                            <div class="selection-item">
                                <span class="selection-icon">â˜†</span>
                                <span id="coverCount" class="selection-count">0</span>
                                <span class="selection-label">COVER</span>
                            </div>
                        </div>
                    </div>
                    <div class="thumbnails-wrapper">
                        <div class="thumbnails-container" id="thumbnailsContainer">
                            <div class="thumbnails-loading" id="thumbnailsLoading">
                                <div class="loading-spinner"></div>
                                <span class="loading-text">Loading pages...</span>
                            </div>
                            <!-- Thumbnails will be dynamically added here -->
                        </div>
                    </div>
                </aside>

                <!-- Enhanced Preview Area -->
                <div class="preview-area">
                    <div id="previewPanel" class="preview-panel">
                        <div class="preview-header">
                            <div class="preview-title-section">
                                <h3 class="preview-title">COMPOSITION PREVIEW</h3>
                                <div class="preview-status" id="previewStatus">
                                    <span class="status-indicator"></span>
                                    <span class="status-text">Select citations to preview</span>
                                </div>
                            </div>
                            <div class="preview-mode-controls">
                                <div class="mode-switcher" id="modeSwitcher">
                                    <button class="mode-btn active" data-mode="custom">
                                        <span class="mode-icon">â§‰</span>
                                        <span class="mode-label">OVERLAY</span>
                                    </button>
                                    <button class="mode-btn" data-mode="sidebyside">
                                        <span class="mode-icon">â§‰â§‰</span>
                                        <span class="mode-label">SIDEÃ—SIDE</span>
                                    </button>
                                </div>
                                <div class="preview-actions">
                                    <button id="resetCoverBtn" class="action-btn" title="Reset cover position">
                                        <span class="btn-icon">â†»</span>
                                    </button>
                                    <button id="togglePreview" class="action-btn" title="Toggle preview visibility">
                                        <span class="btn-icon">â–¶</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-content">
                            <!-- Empty State -->
                            <div class="preview-empty-state" id="previewEmptyState">
                                <div class="empty-state-icon">ðŸ“„</div>
                                <h4 class="empty-state-title">NO PREVIEW</h4>
                                <p class="empty-state-text">Select citations from the page thumbnails to generate a composition preview.</p>
                            </div>
                            
                            <!-- Single Preview Container -->
                            <div class="preview-viewport" id="previewViewport" style="display: none;">
                                <div class="preview-canvas-container">
                                    <canvas id="previewCanvas"></canvas>
                                    <div id="coverImageContainer" class="cover-image-container hidden">
                                        <canvas id="coverCanvas" class="cover-canvas"></canvas>
                                        <div class="cover-selection-indicator"></div>
                                        <div class="cover-controls">
                                            <div class="resize-handle resize-handle-se"></div>
                                        </div>
                                    </div>
                                    <div class="interaction-overlay" id="interactionOverlay">
                                        <div class="interaction-hint">
                                            <span class="hint-text">Drag cover to reposition â€¢ Pinch or scroll to resize</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Batch Preview Container -->
                            <div class="batch-preview-container" id="batchPreviewContainer" style="display: none;">
                                <div class="batch-preview-list" id="batchPreviewList">
                                    <!-- Multiple preview items will be added here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Enhanced Controls Panel -->
                        <div class="controls-panel" id="controlsPanel" style="display: none;">
                            <div class="controls-section">
                                <div class="transform-controls">
                                    <h4 class="controls-title">COVER TRANSFORM</h4>
                                    <div class="transform-grid">
                                        <div class="transform-item">
                                            <label>Position</label>
                                            <span id="coverPositionInfo">0, 0</span>
                                        </div>
                                        <div class="transform-item">
                                            <label>Scale</label>
                                            <span id="coverScaleInfo">25%</span>
                                        </div>
                                        <div class="transform-item">
                                            <label>Size</label>
                                            <span id="coverSizeInfo">0 Ã— 0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="export-controls">
                                    <div class="export-format-section">
                                        <label for="previewExportFormat" class="control-label">Export Format</label>
                                        <select id="previewExportFormat" class="format-select">
                                            <option value="pdf">PDF Document</option>
                                            <option value="png">PNG Image</option>
                                            <option value="jpeg">JPEG Image</option>
                                        </select>
                                    </div>
                                    <button id="exportPreviewBtn" class="export-btn" disabled>
                                        <span class="btn-icon">â†—</span>
                                        <span class="btn-text">EXPORT</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-state hidden">
                <div class="loading-content">
                    <div class="loading-icon">
                        <canvas id="loadingPreviewCanvas"></canvas>
                    </div>
                    <h3>LOADING PDF DOCUMENT</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">0%</div>
                    <p class="loading-caption">/// PLEASE WAIT</p>
                </div>
            </div>
        </main>


        <!-- Toast Notifications -->
        <div id="toastContainer" class="toast-container"></div>
    </div>

    <!-- Hidden File Input -->
    <input type="file" id="fileInput" accept=".pdf" style="display: none;">

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="app.js"></script>
    <script>
        // Initialize app when everything is ready - prevent duplicate initialization
        if (!window.pdfAppInitialized) {
            window.pdfAppInitialized = false;
            
            function initializeAppOnce() {
                if (window.pdfAppInitialized) {
                    console.log('App already initialized, skipping duplicate call');
                    return;
                }
                window.pdfAppInitialized = true;
                
                console.log('DOM loaded, initializing app...');
                if (typeof PDFComposerApp !== 'undefined') {
                    window.pdfApp = new PDFComposerApp();
                } else {
                    console.error('PDFComposerApp class not found');
                }
            }
            
            // Use multiple events but ensure only one fires
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeAppOnce, { once: true });
            } else {
                // DOM is already ready
                setTimeout(initializeAppOnce, 0);
            }
            
            // Fallback - ensure it runs at most once
            window.addEventListener('load', initializeAppOnce, { once: true });
        }
    </script>
</body>
</html>